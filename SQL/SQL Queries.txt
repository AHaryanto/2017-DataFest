All queries are labled the same from checkpoint 3

2a
SELECT B.title
FROM Book B, Author A
WHERE B.author_ID=A.author_ID AND A.Lname='Pratchett' AND B.Price<10
GROUP BY B.title;

2b
SELECT B.title, O.date
FROM Customer C, Orders O, Book B, Buys A
WHERE C.customer_ID = A.customer_ID AND A.order_ID = O.order_ID AND B.book_ID = A.book_ID AND C.fname = 'A'
GROUP BY B.title;

2c
SELECT B.ISBN, B.title
FROM Book B, WAREHOUSE W
WHERE B.book_ID = W.book_ID
GROUP BY 1,2
HAVING count(*)<5;

2d
SELECT C.fname, C.lname, B.title
FROM Customer C, Book B, Orders O, Author A, Buys K
WHERE C.customer_ID=K.customer_ID AND O.order_ID=K.order_ID AND B.author_ID=A.author_ID AND K.book_ID = B.book_ID AND A.lname='Pratchett'
ORDER BY C.fname;

2e
SELECT C.Fname, C.Lname, count(A.book_ID)
FROM CUSTOMER C, BUYS A
WHERE C.Fname = 'A' AND C.lname = 'B' AND A.customer_ID = C.customer_ID;

2f
SELECT C.Fname, C.lname, max(y.num)
FROM Customer C, Buys A, (SELECT count(A.book_ID) as num
FROM BUYS A, Customer C
WHERE A.customer_ID = C.customer_ID
GROUP BY C.customer_ID) y
WHERE C.customer_ID = A.customer_ID;

3a
SELECT E.employee_ID, MAX(E.wage)
FROM EMPLOYEE E;

3b
SELECT *
FROM PUBLISHER P, BOOK B
WHERE P.publisher_name = 'Pearson'
AND P.book_ID = B.book_ID;

3c
SELECT W.warehouse_ID, count(B.book_ID)
FROM WAREHOUSE W, BOOK B
WHERE W.book_ID = B.book_ID
GROUP BY W.warehouse_ID;

4a
SELECT C.FNAME, C.LNAME, sum(O.total)
FROM CUSTOMER C, ORDERS O, BUYS A
WHERE C.customer_ID = A.customer_ID
AND A.order_ID = O.order_ID
GROUP BY C.LNAME;

4b
SELECT C.customer_ID, O.order_ID, O.total
FROM CUSTOMER C, ORDERS O
WHERE C.customer_ID = O.customer_ID
GROUP BY C.Lname
HAVING O.total > (SELECT AVG(total)
FROM ORDERS);

4c
SELECT B.title, count(A.book_ID) AS copies_sold
FROM BOOK B, CUSTOMER C, ORDERS O, BUYS A
WHERE B.book_ID = A.book_ID
AND A.order_ID = O.order_ID
AND C.customer_ID = A.customer_ID
GROUP BY A.book_ID
ORDER BY count(A.book_ID) DESC;

4d
SELECT B.title, count(A.book_ID)*B.price AS Profit
FROM BOOK B, CUSTOMER C, ORDERS O, BUYS A
WHERE C.customer_ID = A.customer_ID
AND B.book_ID = A.book_ID
AND A.order_ID = O.order_ID
GROUP BY B.title
ORDER BY Profit DESC;

4e
SELECT A.Fname, A.Lname, count(B.book_ID)
FROM Author A, BUYS B
WHERE A.book_ID = B.book_ID
GROUP BY A.author_ID
HAVING count(B.book_ID) = (SELECT MAX(y.num)
FROM AUTHOR A, (SELECT count(B.book_ID) AS num
FROM BUYS B, Author A
WHERE B.book_ID = A.book_ID
GROUP BY A.author_ID) y);

4f
SELECT A.author_ID, MAX(BPRICE)
FROM AUTHOR A, BOOK B, ORDERS O, BUYS K, (
SELECT count(A.book_ID)*B.price AS BPRICE, A.book_ID AS ID
FROM BUYS A, BOOK B
WHERE A.book_ID = B.book_ID
GROUP BY B.book_ID) y
WHERE A.book_ID = B.book_ID AND K.order_ID = O.order_ID AND y.ID = B.book_ID
AND K.book_ID = B.book_ID;

4g
SELECT C.Fname, C.Lname, C.customer_ID, C.street1, C.street2, C.city, C.country, C.postal
FROM Customer C, BUYS A, BOOK B,
(SELECT A.author_ID AS BSELLA, MAX(BPRICE)
FROM AUTHOR A, BOOK B, ORDERS O, BUYS K, (
SELECT count(A.book_ID)*B.price AS BPRICE, A.book_ID AS ID
FROM BUYS A, BOOK B
WHERE A.book_ID = B.book_ID
GROUP BY B.book_ID) y
WHERE A.book_ID = B.book_ID AND K.order_ID = O.order_ID AND y.ID = B.book_ID
AND K.book_ID = B.book_ID) y
WHERE C.customer_ID = A.customer_ID AND B.book_ID = A.book_ID AND B.author_ID = y.BSELLA;

4h
SELECT A.Fname, A.Lname
FROM AUTHOR A, BOOK B, CUSTOMER C, ORDERS O, BUYS Y
WHERE C.customer_ID = Y.customer_ID AND Y.book_ID = B.book_ID AND B.book_ID = A.book_ID AND Y.order_ID = O.order_ID AND C.customer_ID IN
(SELECT C.customer_ID
FROM CUSTOMER C, ORDERS O
WHERE C.customer_ID = O.customer_ID
GROUP BY C.Lname
HAVING O.total > (SELECT AVG(total)
FROM ORDERS))
GROUP BY A.Fname;



